import { LitElement, html } from 'lit';
import { customElement } from 'lit/decorators.js';
import { injectTheme } from '#decorators/theme.js';

import TWEEN from '@tweenjs/tween.js';

import styles from './wave-background.css?inline';

@customElement('wave-background')
export class WaveBackground extends LitElement {
  @injectTheme(styles)
  static styles;

  tweens = [];

  constructor() {
    super();

    this.animate();
  }

  animate = (time) => {
    this.tweens.forEach((tween) => {
      tween.update(time);
    });

    requestAnimationFrame(this.animate);
  };

  getRandomInt(min, max) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min) + min);
  }

  maxDistance(old, cur, max) {
    if (Math.abs(old - cur) > max) {
      if (old < cur) {
        return old + max;
      } else {
        return old - max;
      }
    }
    return cur;
  }

  generateTween(coords) {
    const next = { translateX: this.getRandomInt(50, -50), scaleY: this.getRandomInt(95, 100) };
    const distance = Math.abs(coords.translateX - next.translateX);
    const ratio = distance / 50;
    return new TWEEN.Tween(coords, false)
      .to(next, 8000 * ratio)
      .easing(TWEEN.Easing.Quadratic.InOut)
      .start();
  }

  generateForPath(path, coords) {
    const tween = this.generateTween(coords);
    this.tweens.push(tween);
    tween.onComplete(() => {
      this.tweens = this.tweens.filter((t) => t !== tween);
      this.generateForPath(path, coords);
    });
    tween.onUpdate(() => {
      path.style.setProperty('transform', `translate(${coords.translateX}%, ${coords.translateY}%) scale(${coords.scaleX}%, ${coords.scaleY}%)`);
    });
    tween.start();
  }

  updated(changedProperties) {
    super.updated(changedProperties);

    const svg = this.renderRoot.querySelector('svg');

    const paths = svg.querySelectorAll('path');

    paths.forEach((path) => {
      this.generateForPath(path, { translateX: 0, translateY: 0, scaleX: 200, scaleY: 100 });
    });
  }

  render() {
    return html`
      <svg
        id="visual"
        viewBox="0 0 500 350"
        width="100%"
        height="100%"
        xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink"
        version="1.1"
        preserveAspectRatio="none"
      >
        <path
          d="M0 99L3.8 86C7.7 73 15.3 47 22.8 44.5C30.3 42 37.7 63 45.2 72.2C52.7 81.3 60.3 78.7 68 75.7C75.7 72.7 83.3 69.3 91 66.2C98.7 63 106.3 60 113.8 49.3C121.3 38.7 128.7 20.3 136.2 15.2C143.7 10 151.3 18 159 35.2C166.7 52.3 174.3 78.7 182 88.5C189.7 98.3 197.3 91.7 204.8 92C212.3 92.3 219.7 99.7 227.2 102.5C234.7 105.3 242.3 103.7 250 92.2C257.7 80.7 265.3 59.3 272.8 50.5C280.3 41.7 287.7 45.3 295.2 54C302.7 62.7 310.3 76.3 318 78.2C325.7 80 333.3 70 341 72C348.7 74 356.3 88 363.8 82.5C371.3 77 378.7 52 386.2 41.3C393.7 30.7 401.3 34.3 409 46.3C416.7 58.3 424.3 78.7 432 83.8C439.7 89 447.3 79 454.8 80.2C462.3 81.3 469.7 93.7 477.2 92.3C484.7 91 492.3 76 496.2 68.5L500 61L500 351L496.2 351C492.3 351 484.7 351 477.2 351C469.7 351 462.3 351 454.8 351C447.3 351 439.7 351 432 351C424.3 351 416.7 351 409 351C401.3 351 393.7 351 386.2 351C378.7 351 371.3 351 363.8 351C356.3 351 348.7 351 341 351C333.3 351 325.7 351 318 351C310.3 351 302.7 351 295.2 351C287.7 351 280.3 351 272.8 351C265.3 351 257.7 351 250 351C242.3 351 234.7 351 227.2 351C219.7 351 212.3 351 204.8 351C197.3 351 189.7 351 182 351C174.3 351 166.7 351 159 351C151.3 351 143.7 351 136.2 351C128.7 351 121.3 351 113.8 351C106.3 351 98.7 351 91 351C83.3 351 75.7 351 68 351C60.3 351 52.7 351 45.2 351C37.7 351 30.3 351 22.8 351C15.3 351 7.7 351 3.8 351L0 351Z"
          fill="#c52c76"
        ></path>
        <path
          d="M0 135L3.8 131C7.7 127 15.3 119 22.8 115.2C30.3 111.3 37.7 111.7 45.2 112.2C52.7 112.7 60.3 113.3 68 110.2C75.7 107 83.3 100 91 91C98.7 82 106.3 71 113.8 68.7C121.3 66.3 128.7 72.7 136.2 70.8C143.7 69 151.3 59 159 56.5C166.7 54 174.3 59 182 70.8C189.7 82.7 197.3 101.3 204.8 102.7C212.3 104 219.7 88 227.2 88.3C234.7 88.7 242.3 105.3 250 113.8C257.7 122.3 265.3 122.7 272.8 125.5C280.3 128.3 287.7 133.7 295.2 120.7C302.7 107.7 310.3 76.3 318 61C325.7 45.7 333.3 46.3 341 61.7C348.7 77 356.3 107 363.8 118.3C371.3 129.7 378.7 122.3 386.2 119.2C393.7 116 401.3 117 409 114C416.7 111 424.3 104 432 99.8C439.7 95.7 447.3 94.3 454.8 94.7C462.3 95 469.7 97 477.2 97.5C484.7 98 492.3 97 496.2 96.5L500 96L500 351L496.2 351C492.3 351 484.7 351 477.2 351C469.7 351 462.3 351 454.8 351C447.3 351 439.7 351 432 351C424.3 351 416.7 351 409 351C401.3 351 393.7 351 386.2 351C378.7 351 371.3 351 363.8 351C356.3 351 348.7 351 341 351C333.3 351 325.7 351 318 351C310.3 351 302.7 351 295.2 351C287.7 351 280.3 351 272.8 351C265.3 351 257.7 351 250 351C242.3 351 234.7 351 227.2 351C219.7 351 212.3 351 204.8 351C197.3 351 189.7 351 182 351C174.3 351 166.7 351 159 351C151.3 351 143.7 351 136.2 351C128.7 351 121.3 351 113.8 351C106.3 351 98.7 351 91 351C83.3 351 75.7 351 68 351C60.3 351 52.7 351 45.2 351C37.7 351 30.3 351 22.8 351C15.3 351 7.7 351 3.8 351L0 351Z"
          fill="#9a327c"
        ></path>
        <path
          d="M0 141L3.8 140.8C7.7 140.7 15.3 140.3 22.8 148.2C30.3 156 37.7 172 45.2 172.5C52.7 173 60.3 158 68 150C75.7 142 83.3 141 91 145.5C98.7 150 106.3 160 113.8 163.8C121.3 167.7 128.7 165.3 136.2 165.7C143.7 166 151.3 169 159 164.2C166.7 159.3 174.3 146.7 182 143.8C189.7 141 197.3 148 204.8 152C212.3 156 219.7 157 227.2 158.7C234.7 160.3 242.3 162.7 250 167.3C257.7 172 265.3 179 272.8 170.2C280.3 161.3 287.7 136.7 295.2 133C302.7 129.3 310.3 146.7 318 148.2C325.7 149.7 333.3 135.3 341 138.3C348.7 141.3 356.3 161.7 363.8 163.2C371.3 164.7 378.7 147.3 386.2 142.7C393.7 138 401.3 146 409 151.5C416.7 157 424.3 160 432 157.5C439.7 155 447.3 147 454.8 149.5C462.3 152 469.7 165 477.2 164.7C484.7 164.3 492.3 150.7 496.2 143.8L500 137L500 351L496.2 351C492.3 351 484.7 351 477.2 351C469.7 351 462.3 351 454.8 351C447.3 351 439.7 351 432 351C424.3 351 416.7 351 409 351C401.3 351 393.7 351 386.2 351C378.7 351 371.3 351 363.8 351C356.3 351 348.7 351 341 351C333.3 351 325.7 351 318 351C310.3 351 302.7 351 295.2 351C287.7 351 280.3 351 272.8 351C265.3 351 257.7 351 250 351C242.3 351 234.7 351 227.2 351C219.7 351 212.3 351 204.8 351C197.3 351 189.7 351 182 351C174.3 351 166.7 351 159 351C151.3 351 143.7 351 136.2 351C128.7 351 121.3 351 113.8 351C106.3 351 98.7 351 91 351C83.3 351 75.7 351 68 351C60.3 351 52.7 351 45.2 351C37.7 351 30.3 351 22.8 351C15.3 351 7.7 351 3.8 351L0 351Z"
          fill="#6e3576"
        ></path>
        <path
          d="M0 147L3.8 151.2C7.7 155.3 15.3 163.7 22.8 171.7C30.3 179.7 37.7 187.3 45.2 186.7C52.7 186 60.3 177 68 170.5C75.7 164 83.3 160 91 163.5C98.7 167 106.3 178 113.8 174.5C121.3 171 128.7 153 136.2 144.8C143.7 136.7 151.3 138.3 159 139.5C166.7 140.7 174.3 141.3 182 146.7C189.7 152 197.3 162 204.8 163.7C212.3 165.3 219.7 158.7 227.2 160.8C234.7 163 242.3 174 250 181.3C257.7 188.7 265.3 192.3 272.8 188.8C280.3 185.3 287.7 174.7 295.2 180.2C302.7 185.7 310.3 207.3 318 202.5C325.7 197.7 333.3 166.3 341 157.7C348.7 149 356.3 163 363.8 176.7C371.3 190.3 378.7 203.7 386.2 197.2C393.7 190.7 401.3 164.3 409 150C416.7 135.7 424.3 133.3 432 133.8C439.7 134.3 447.3 137.7 454.8 146.5C462.3 155.3 469.7 169.7 477.2 172.2C484.7 174.7 492.3 165.3 496.2 160.7L500 156L500 351L496.2 351C492.3 351 484.7 351 477.2 351C469.7 351 462.3 351 454.8 351C447.3 351 439.7 351 432 351C424.3 351 416.7 351 409 351C401.3 351 393.7 351 386.2 351C378.7 351 371.3 351 363.8 351C356.3 351 348.7 351 341 351C333.3 351 325.7 351 318 351C310.3 351 302.7 351 295.2 351C287.7 351 280.3 351 272.8 351C265.3 351 257.7 351 250 351C242.3 351 234.7 351 227.2 351C219.7 351 212.3 351 204.8 351C197.3 351 189.7 351 182 351C174.3 351 166.7 351 159 351C151.3 351 143.7 351 136.2 351C128.7 351 121.3 351 113.8 351C106.3 351 98.7 351 91 351C83.3 351 75.7 351 68 351C60.3 351 52.7 351 45.2 351C37.7 351 30.3 351 22.8 351C15.3 351 7.7 351 3.8 351L0 351Z"
          fill="#463367"
        ></path>
        <path
          d="M0 241L3.8 238.7C7.7 236.3 15.3 231.7 22.8 221.2C30.3 210.7 37.7 194.3 45.2 187.2C52.7 180 60.3 182 68 197.2C75.7 212.3 83.3 240.7 91 243C98.7 245.3 106.3 221.7 113.8 219.3C121.3 217 128.7 236 136.2 236.3C143.7 236.7 151.3 218.3 159 220.7C166.7 223 174.3 246 182 256.8C189.7 267.7 197.3 266.3 204.8 264.5C212.3 262.7 219.7 260.3 227.2 247.2C234.7 234 242.3 210 250 204.8C257.7 199.7 265.3 213.3 272.8 218.2C280.3 223 287.7 219 295.2 223.5C302.7 228 310.3 241 318 238.5C325.7 236 333.3 218 341 209.3C348.7 200.7 356.3 201.3 363.8 197.3C371.3 193.3 378.7 184.7 386.2 187.5C393.7 190.3 401.3 204.7 409 206C416.7 207.3 424.3 195.7 432 198.5C439.7 201.3 447.3 218.7 454.8 220.7C462.3 222.7 469.7 209.3 477.2 204.8C484.7 200.3 492.3 204.7 496.2 206.8L500 209L500 351L496.2 351C492.3 351 484.7 351 477.2 351C469.7 351 462.3 351 454.8 351C447.3 351 439.7 351 432 351C424.3 351 416.7 351 409 351C401.3 351 393.7 351 386.2 351C378.7 351 371.3 351 363.8 351C356.3 351 348.7 351 341 351C333.3 351 325.7 351 318 351C310.3 351 302.7 351 295.2 351C287.7 351 280.3 351 272.8 351C265.3 351 257.7 351 250 351C242.3 351 234.7 351 227.2 351C219.7 351 212.3 351 204.8 351C197.3 351 189.7 351 182 351C174.3 351 166.7 351 159 351C151.3 351 143.7 351 136.2 351C128.7 351 121.3 351 113.8 351C106.3 351 98.7 351 91 351C83.3 351 75.7 351 68 351C60.3 351 52.7 351 45.2 351C37.7 351 30.3 351 22.8 351C15.3 351 7.7 351 3.8 351L0 351Z"
          fill="#252c50"
        ></path>
        <path
          d="M0 225L3.8 232.7C7.7 240.3 15.3 255.7 22.8 267.5C30.3 279.3 37.7 287.7 45.2 290.3C52.7 293 60.3 290 68 283.5C75.7 277 83.3 267 91 260.7C98.7 254.3 106.3 251.7 113.8 254.8C121.3 258 128.7 267 136.2 264C143.7 261 151.3 246 159 238.5C166.7 231 174.3 231 182 234.8C189.7 238.7 197.3 246.3 204.8 255.2C212.3 264 219.7 274 227.2 280C234.7 286 242.3 288 250 291.5C257.7 295 265.3 300 272.8 298C280.3 296 287.7 287 295.2 282.3C302.7 277.7 310.3 277.3 318 272.7C325.7 268 333.3 259 341 260.7C348.7 262.3 356.3 274.7 363.8 276C371.3 277.3 378.7 267.7 386.2 263.7C393.7 259.7 401.3 261.3 409 258C416.7 254.7 424.3 246.3 432 246C439.7 245.7 447.3 253.3 454.8 251C462.3 248.7 469.7 236.3 477.2 229.8C484.7 223.3 492.3 222.7 496.2 222.3L500 222L500 351L496.2 351C492.3 351 484.7 351 477.2 351C469.7 351 462.3 351 454.8 351C447.3 351 439.7 351 432 351C424.3 351 416.7 351 409 351C401.3 351 393.7 351 386.2 351C378.7 351 371.3 351 363.8 351C356.3 351 348.7 351 341 351C333.3 351 325.7 351 318 351C310.3 351 302.7 351 295.2 351C287.7 351 280.3 351 272.8 351C265.3 351 257.7 351 250 351C242.3 351 234.7 351 227.2 351C219.7 351 212.3 351 204.8 351C197.3 351 189.7 351 182 351C174.3 351 166.7 351 159 351C151.3 351 143.7 351 136.2 351C128.7 351 121.3 351 113.8 351C106.3 351 98.7 351 91 351C83.3 351 75.7 351 68 351C60.3 351 52.7 351 45.2 351C37.7 351 30.3 351 22.8 351C15.3 351 7.7 351 3.8 351L0 351Z"
          fill="#132134"
        ></path>
        <path
          d="M0 332L3.8 329C7.7 326 15.3 320 22.8 320.3C30.3 320.7 37.7 327.3 45.2 329.2C52.7 331 60.3 328 68 318.5C75.7 309 83.3 293 91 288.3C98.7 283.7 106.3 290.3 113.8 289.5C121.3 288.7 128.7 280.3 136.2 278.3C143.7 276.3 151.3 280.7 159 281C166.7 281.3 174.3 277.7 182 274.2C189.7 270.7 197.3 267.3 204.8 267.7C212.3 268 219.7 272 227.2 283.2C234.7 294.3 242.3 312.7 250 317.5C257.7 322.3 265.3 313.7 272.8 303.8C280.3 294 287.7 283 295.2 289.7C302.7 296.3 310.3 320.7 318 319.3C325.7 318 333.3 291 341 284.7C348.7 278.3 356.3 292.7 363.8 302C371.3 311.3 378.7 315.7 386.2 309.5C393.7 303.3 401.3 286.7 409 277.2C416.7 267.7 424.3 265.3 432 264C439.7 262.7 447.3 262.3 454.8 273C462.3 283.7 469.7 305.3 477.2 308C484.7 310.7 492.3 294.3 496.2 286.2L500 278L500 351L496.2 351C492.3 351 484.7 351 477.2 351C469.7 351 462.3 351 454.8 351C447.3 351 439.7 351 432 351C424.3 351 416.7 351 409 351C401.3 351 393.7 351 386.2 351C378.7 351 371.3 351 363.8 351C356.3 351 348.7 351 341 351C333.3 351 325.7 351 318 351C310.3 351 302.7 351 295.2 351C287.7 351 280.3 351 272.8 351C265.3 351 257.7 351 250 351C242.3 351 234.7 351 227.2 351C219.7 351 212.3 351 204.8 351C197.3 351 189.7 351 182 351C174.3 351 166.7 351 159 351C151.3 351 143.7 351 136.2 351C128.7 351 121.3 351 113.8 351C106.3 351 98.7 351 91 351C83.3 351 75.7 351 68 351C60.3 351 52.7 351 45.2 351C37.7 351 30.3 351 22.8 351C15.3 351 7.7 351 3.8 351L0 351Z"
          fill="#0c1319"
        ></path>
      </svg>
    `;
  }
}
